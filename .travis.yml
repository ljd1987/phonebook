language: java
sudo: required
install: true

services:
  - docker
  - mongodb

env:
  - secure: o/MgZvwpGVG2JyCOUI3dqpMCFCWdOV3ht5L+hV6PUBxXutaI3RYEOPr90mZdwqw7ifGR5YNtVf2Xm1X7M91iCFOsFsMxjHQl/Xlh7doXyW2SYZcB90xR8igEEQpxbxnoDsSUm0XtT3aENSN8YrNQ5WcbN8X/v/qNKktLCa4bLVj+lXBjkNYDtY+of/fcUv58GCbCkQjRqGy8sYYBG4HC8eWwBt4kE/OCEQkQA6wzhCqXE+WOswNkfwRCIkAQoLrHXWDW4dGq9lgHFvoRBUGAN+eF+Aw7itCne30/Yy63Pa1bQx7TkL6sS7gHIMgu4qIG4zhxQ/iBP0cMK4ZPtEcS9B78DZZJe6EtdEQRMlJ7rIGegzHUOzhz4Nv87bO9xvFVkxPnwXIImCixXV9J4dfLHXZIwIm7/wLJydvaG2WKiNaw/kVWkiB7Y6m/11SDgp+ZGm5rH0TPiziftu/03xM2U5O7hUe8ZrbTZE9b39MXD+rfbmQWldNYlDFQ2jWvaH/aw2WuWjrdaP83Duaz8EmnKTJW+myqD1/GNZLsd8Yzh0ivtzEM0UWpKACBBud6mtNSFfCzOuovkb8/O1HZ0bIhm6PKwjUFyNXwtYNIylWJKcv5BhQCd4sVnHQDOv7yqwElPtTyxAnjuIVvGkk5oUNkEyinH3YDexrsLrjhaAGDLLo=
  - secure: BxIQeFCtXj+QjHVsoH0vXQzLHgcmdeSwSA5ByQUFUZwwaEpqanBMANsSnLHQG+NfdYnCJYbOuojISZ/8zMuefscoIKGoAh8cI0RhwiB0JhpyCSR0N3GDnAclu7r181oMCJjgWUL1s7/b9vlsLhHSaTgxstA4hNiUEBxd1RN1Ezi/nI/E+Bs515OcwwrTDodBI0KWqzKO9ysJfyrjtK0poEKxeQ88PO2iDJBPr6VGYDf1aV5Zr5NjoYeNiiJ+Yhj8gbStE4x1JpSJeWDGXa/hTOipIZ+reDMvP8TF2av0ALNwuykvzRWgVUzJsAy9pCoVPYXLaswBcNoIWjBstgyz589y/6wWFMcuBfSEUBeXrlcVcAwyN8Yw9CnYBmYV1/UOu6/hbZ8Sv479mLmN6Mo/X6LUupd3IrMAjIfQXUlhiJ6L9wfruwOuSwICkjZOAPDfgQEnC2t2cLODNPWiCR/czUjWSGE+XH6gZGZ1UUQDFdaWcnHa0Sd54O6uaL73o+iYcg5Ydi2wbVNjN+URgGl8lwQgrjVmMkq2GSHtkGd9Ab5N/TD0CRssjuRHC0db3AVl9/qwZStdAO7McYq4MxzWXP6bfPg8sBnRlPL4weI7Eki8L1zgCQZACZOiVCCy87Jj5cBUHqT/tKoWK6a1HU0U5sIqI3EFIc6SZxiiMC3H8rY=

addons:
  sonarcloud:
    organization: ljd1987-github
    token:
      secure: dmSHV8SFcJc5RHyKQanIxtFhEQs05m97JEsXXBExWq1vLBrv6WUFCvL4mqbO50Nw0wZkOrK0LcZaCJWiNrTbOV3k6YcS81soLPjILpYkRwxIkW8OQL6A9dsr57ATkoXTZIEgUiYOopzHyOLugTbai9EMqq6f2iqUv31pOuU723TZd05O6qWZ74+1krKyk38h/ofiAkYwAPtDic8ZO0rAqXNuq7HN6jKuhfY7VF9vhZAiivKUCbhQD9meF63i01Ce6gN8XALUJ+cubZ5bdRbPQ/CcUykQU6QE8Y1JGap29g5Rxv7smv0MfbpcwAgEwAGlThhKaABIBcqC9oqvUn8b9woFMEWooBO9gIXItBsbcdsn7Gp2ejnSeyD1chSag0T238K4D70B4dd2eMRJ9yWxaVtXP4LXKLcQOF48Za5tyai/HEZLYfy80jp3L3R/7q7/Iziusee+4uBRsmmCXpO4B4Iwy20jskt5SGnKa6JDaKwEpbJLPTs+RZr4gFiT19F56LLvREkGtYgOzyWK54gzehv2zoCeUgby/BRWnR0GFZ8fF0gMtiMPTQJUvvXY8nPZFf+lkvl5SFmxTYfP0FWHIWKuCtsrAkdcWH+rdjbZsBjlfE3EtFypCLsC2A+0UtyUn/T8nhQSvv9m9yImAYF8+b6EqdaTmtntOp+mxB0j9Is=
jdk:
  - oraclejdk8

cache:
  directories:
    - "$HOME/.m2/repository"

script:
  - set -e
  - echo $TRAVIS_BRANCH
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar
  - cp target/phonebook.war image/
  - docker build -t ljd1987/phonebook image/
  # - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
  # - docker push ljd1987/phonebook

deploy:
  provider: script
  script: bash docker_push.sh
  on:
    branch: master